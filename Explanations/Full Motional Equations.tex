\documentclass{article}
\usepackage{graphicx}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{enumerate}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{hyperref}
\usepackage{placeins}
\usepackage[title]{appendix}
\usepackage{float}
\usepackage{comment}
\usepackage{multicol}
\setlength\columnsep{10pt}
\usepackage{soul}
\usepackage{gensymb}
\usepackage{enumitem}
\usepackage{subcaption}
\usepackage{physics}
\usepackage{color}

\usepackage{fancyhdr}
\usepackage{currfile}
\usepackage[us,12hr]{datetime}
\fancypagestyle{plain}{
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}}

\usepackage[margin=0.6in]{geometry}

\title{Resolving Full Motion in Presence of Micromotion}

\begin{document}

\maketitle

\noindent The equation of motion we are interested in solving is:
\begin{equation}
v_p''(\tau) = - \frac{(2 \pi)^2}{\beta^2} \left( a_p - 2 q_x \cos \left( \frac{4 \pi \tau}{\beta} \right) \right) v_p (\tau)	
\label{eq:mathieu}
\end{equation}
Or, if the substitution $\xi = \frac{2 \pi \tau}{\beta}$ (which is equivalent to $\xi = \frac{\omega_{RF}}{2} t$, as $\tau = \frac{\beta \omega_{RF}}{4 \pi} t$) is made:
\begin{equation}
v_p''(\xi)	= - \left( a_p - 2 q_x \cos \left( 2 \xi \right) \right) v_p (\xi)
\label{eq:mathieusimple}
\end{equation}
The stable solutions of the Mathieu Equation can be found from Floquet's Theorem, which states that the Mathieu Equation admits a complex-valued solution of the form:
\begin{equation}
F(a_p ,q_x,\xi) = e^{i \beta_p \xi} P (2 \xi) + e^{-i \beta_p \xi} P(-2 \xi)
\end{equation}
Here, $\beta_p$ is some complex number (which we have not yet defined), denoted as the Floquet exponent. $P (2 \xi)$ is a complex-valued function of the same period as the periodic function in our differential equation, which is given in \eqref{eq:mathieusimple} (hence the dependency on $2 \xi$). That is, $P (2 \xi)$ is a periodic function with $\pi$, which allows us to generate a general Fourier series for $P (2 \xi)$:
\begin{equation}
P (2 \xi) = \sum_{n = - \infty}^{\infty} C_n e^{i 2 n \xi}	
\end{equation}
Ultimately, this gives the stable solutions of the Mathieu Equation as:
\begin{equation}
	v_p (\xi) = A e^{i \beta_p \xi} \sum_{n = - \infty}^{\infty} C_{n} e^{i 2 n \xi} + B e^{- i \beta_p \xi} \sum_{n = - \infty}^{\infty} C_{n} e^{- i 2 n \xi}
	\label{eq:motion}
\end{equation}
$\beta_p$, the Floquet exponent, is a mode-specific value that is defined from the recurrence relations, and $\beta$ is chosen as $\beta := \beta_1$ (see 'Secular Limit of Micromotion' document). If we now convert back to the non-dimensionalised time $\tau$ (which is related to $\xi$ via $\xi = \frac{2 \pi}{\beta} \tau$), this becomes:
\begin{equation}
	v_p (\tau) = A e^{i 2 \pi \frac{\beta_p}{\beta} \tau} \sum_{n = - \infty}^{\infty} C_{n} e^{i n \frac{4 \pi \tau}{\beta}} + B e^{- i 2 \pi \frac{\beta_p}{\beta} \tau} \sum_{n = - \infty}^{\infty} C_{n} e^{- i n \frac{4 \pi \tau}{\beta}}
	\label{eq:motion2}
\end{equation}
By modifying $A$ and $B$, this can be shifted to:
\begin{equation}
	v_p (\tau) = A' e^{i 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_0)} \sum_{n = - \infty}^{\infty} C_{n} e^{i n \frac{4 \pi \tau}{\beta}} + B' e^{- i 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_0)} \sum_{n = - \infty}^{\infty} C_{n} e^{- i n \frac{4 \pi \tau}{\beta}}
	\label{eq:motion3}
\end{equation}
Its corresponding time derivative is given by:
\begin{align}
	v_p' (\tau) & = A' \left( i 2 \pi \frac{\beta_p}{\beta} \right) e^{i 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_0)} \sum_{n = - \infty}^{\infty} C_{n} e^{i n \frac{4 \pi \tau}{\beta}} + B' \left( - i 2 \pi \frac{\beta_p}{\beta} \right) e^{i 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_0)} \sum_{n = - \infty}^{\infty} C_{n} e^{- i n \frac{4 \pi \tau}{\beta}} \nonumber \\
	& + A' e^{i 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_0)} \sum_{n = - \infty}^{\infty} C_{n} \left(\frac{4 \pi i n}{\beta} \right) e^{i n \frac{4 \pi \tau}{\beta}} + B' e^{- i 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_0)} \sum_{n = - \infty}^{\infty} C_{n} \left(- \frac{4 \pi i n}{\beta} \right) e^{-i n \frac{4 \pi \tau}{\beta}} 
\end{align}
We can solve for $A'$ and $B'$ by equating the motion to initial conditions. Note that $A'$ and $B'$ will need to be complex coefficients in order for the motion as a whole, $v_p (\tau)$, to be purely real. If we impose the initial condition $v_p (\tau_0) = x_0$, then this generates:
\begin{align}
x_0 & = A' \sum_{n = - \infty}^{\infty} C_n e^{i n \frac{4 \pi \tau_0}{\beta}} + B' \sum_{n = -\infty}^{\infty} C_n e^{-i n \frac{4 \pi \tau_0}{\beta}} \\
& = (A'_r + i A'_i) (f_c (\tau_0) + i f_s (\tau_0)) + (B'_r + i B'_i) (f_c (\tau_0) - i f_s (\tau_0) )
\end{align}
where:
\begin{align}
f_c (\tau)	& = \sum_{n = - \infty}^{\infty} C_n \cos \left( \frac{4 n \pi \tau}{\beta} \right) \\
f_s (\tau) & = \sum_{n = - \infty}^{\infty} C_n \sin \left( \frac{4 n \pi \tau}{\beta} \right)
\end{align}
If this is explicitly broken up into its real and imaginary parts, we generate:
\begin{align}
	x_0 & = (A'_r + B'_r) f_c (\tau_0) + (B'_i - A'_i) f_s (\tau_0) \label{eq:cond1} \\
	0 & = (A'_i + B'_i) f_c (\tau_0) + (A'_r - B'_r) f_s (\tau_0) \label{eq:cond2}
\end{align}
If we also impose the initial condition $v_p' (\tau_0) = v_0$, then this generates:
\begin{align}
v_0 & = A' \left( i 2 \pi \frac{\beta_p}{\beta} \right) \sum_{n = - \infty}^{\infty} C_{n} e^{i n \frac{4 \pi \tau_0}{\beta}} + B' \left( - i 2 \pi \frac{\beta_p}{\beta} \right) \sum_{n = - \infty}^{\infty} C_{n} e^{- i n \frac{4 \pi \tau_0}{\beta}} \nonumber \\
	& + A' \sum_{n = - \infty}^{\infty} C_{n} \left(\frac{4 \pi i n}{\beta} \right) e^{i n \frac{4 \pi \tau_0}{\beta}} + B' \sum_{n = - \infty}^{\infty} C_{n} \left(- \frac{4 \pi i n}{\beta} \right) e^{-i n \frac{4 \pi \tau_0}{\beta}} \\
	& = (A'_r + i A'_i) \left(2 \pi \frac{\beta_p}{\beta} \right) (i f_c (\tau_0) - f_s (\tau_0)) + (B'_r + i B'_i) \left(2 \pi \frac{\beta_p}{\beta} \right) (- i f_c (\tau_0) - f_s (\tau_0)) \nonumber \\
	& + (A'_r + i A'_i) (i f_s' (\tau_0) + f_c'(\tau_0)) + (B'_r + i B'_i) (- i f'_s (\tau_0) + f_c' (\tau_0))
\end{align}
If this is explicitly broken up into its real and imaginary parts, we generate:
\begin{align}
v_0 & = \frac{2 \pi \beta_p}{\beta} [ - (A'_r + B'_r ) f_s(\tau_0) + (B'_i - A'_i) f_c (\tau_0) ] + (A'_r + B'_r) f_c'(\tau_0) + (B'_i - A'_i) f_s'(\tau_0) \label{eq:cond3} \\
0 & = \frac{2 \pi \beta_p}{\beta} [ - (A'_i + B'_i) f_s(\tau_0) + (A'_r - B'_r) f_c (\tau_0) ] + (A'_i + B'_i) f_c'(\tau_0) + (A'_r - B'_r) f_s'(\tau_0) \label{eq:cond4}
\end{align}
Equations \eqref{eq:cond1}, \eqref{eq:cond2}, \eqref{eq:cond3} and \eqref{eq:cond4} now fully define $A'$ and $B'$. The components of $A'$ and $B'$ can accordingly be solved as:
\begin{align}
A'_r & = - \frac{1}{2} \frac{f_s (\tau_0) v_0 - x_0 \left( \frac{2 \pi \beta_p}{\beta} f_c (\tau_0) + f_s' (\tau_0) \right)}{f_c (\tau_0) f'_s (\tau_0) - f_c' (\tau_0) f_s (\tau_0) + \frac{2 \pi \beta_p}{\beta} (f_c (\tau_0)^2 + f_s (\tau_0)^2 ) }	\label{eq:Ar} \\
B'_r & = - \frac{1}{2} \frac{f_s (\tau_0) v_0 - x_0 \left( \frac{2 \pi \beta_p}{\beta} f_c (\tau_0) + f_s' (\tau_0) \right)}{f_c (\tau_0) f'_s (\tau_0) - f_c' (\tau_0) f_s (\tau_0) + \frac{2 \pi \beta_p}{\beta} (f_c (\tau_0)^2 + f_s (\tau_0)^2 ) }	\label{eq:Br} \\
A'_i & = - \frac{1}{2} \frac{f_c (\tau_0) v_0 - x_0 \left( - \frac{2 \pi \beta_p}{\beta} f_s (\tau_0) + f_c' (\tau_0) \right) }{f_c (\tau_0) f'_s (\tau_0) - f_c' (\tau_0) f_s (\tau_0) + \frac{2 \pi \beta_p}{\beta} (f_c (\tau_0)^2 + f_s (\tau_0)^2 ) } \label{eq:Ai} \\
B'_i & = \frac{1}{2} \frac{f_c (\tau_0) v_0 - x_0 \left( - \frac{2 \pi \beta_p}{\beta} f_s (\tau_0) + f_c' (\tau_0) \right)}{f_c (\tau_0) f'_s (\tau_0) - f_c' (\tau_0) f_s (\tau_0) + \frac{2 \pi \beta_p}{\beta} (f_c (\tau_0)^2 + f_s (\tau_0)^2 ) } \label{eq:Bi}
\end{align}
We can see that $A$ and $B$ are complex conjugates of one another, which ensures that our motion is indeed real. Substituting $A' = A'_r + i A'_i$ and $B' = A'_r - i A'_i$ (for simplicity) into \eqref{eq:motion3}, the motion becomes:
\begin{equation}
v_p (\tau) = 2 (A'_r f_c (\tau) - A'_i f_s (\tau)) \cos \left( 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_0) \right) - 2 (A'_i f_c (\tau) + A'_r f_s (\tau)) \sin \left( 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_0) \right)
\end{equation}
Accordingly, by substituting the form of $A'_r$ and $A'_i$ from \eqref{eq:Ar} and \eqref{eq:Ai} respectively, we generate the motion:
\begin{align}
\begin{split}
	v_p (\tau) &= \frac{1}{f_c' (\tau_0) f_s (\tau_0) - f_c (\tau_0) f_s' (\tau_0) - \frac{2 \pi \beta_p}{\beta} (f_c (\tau_0)^2 + f_s (\tau_0)^2)} \biggl( \cos \left( 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_0) \right) \biggl( (f_s (\tau_0) v_0 - f_s' (\tau_0) x_0) f_c (\tau) \\
	& + (f_c' (\tau_0) x_0 - f_c (\tau_0) v_0) f_s (\tau) - \frac{2 \pi \beta_p}{\beta} x_0 (f_c (\tau_0) f_c (\tau) + f_s (\tau_0) f_s (\tau)) \biggr) + \sin \left( 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_0) \right) \biggl( f_s (\tau) (f_s' (\tau_0) x_0 \\
	& - f_s (\tau_0) v_0 + \frac{2 \pi \beta_p}{\beta} f_c (\tau_0) x_0 ) + f_c (\tau) (f_c' (\tau_0) x_0 - f_c (\tau) v_0 - \frac{2 \pi \beta_p}{\beta} x_0 f_s (\tau) ) \biggr) \biggr)
\end{split}
\end{align}
To provide a more convenient form of the motion, we can introduce the following constants:
\begin{align}
\sigma_c & = f_c (\tau_0) = \sum_{n = - \infty}^{\infty} C_n \cos \left( \frac{4 n \pi \tau_0}{\beta} \right) \\
\sigma_s & = f_s (\tau_0) = \sum_{n = - \infty}^{\infty} C_n \sin \left( \frac{4 n \pi \tau_0}{\beta} \right) \\
\zeta_c & = \frac{\beta}{4 \pi} f'_s (\tau_0) = \sum_{n = - \infty}^{\infty} n C_n \cos \left( \frac{4 n \pi \tau_0}{\beta} \right) \\
\zeta_s & = - \frac{\beta}{4 \pi} f'_c (\tau_0) = \sum_{n = - \infty}^{\infty} n C_n \sin \left( \frac{4 n \pi \tau_0}{\beta} \right) \\
\rho & = 4 \pi \left( \sigma_c \left( \sigma_c + \frac{2}{\beta_p} \zeta_c \right) + \sigma_s \left( \sigma_s + \frac{2}{\beta_p} \zeta_s \right) \right)
\end{align}
\noindent This allows the motion to be written as:
\begin{align}
\begin{split}
v_p (\tau) & = \frac{2 \beta}{\rho \beta_p} v_0 \sin \left( 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_0) \right) (\sigma_c f_c (\tau - \tau_0) + \sigma_s f_s (\tau - \tau_0)) \\
&+ \frac{2 \beta}{\rho \beta_p} v_0 \cos \left( 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_0) \right) (\sigma_c f_s (\tau - \tau_0) - \sigma_s f_c (\tau - \tau_0)) \\
&+ \frac{2}{\rho \beta_p} 2 \pi x_0 \sin \left( 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_0) \right) ((\beta_p \sigma_s + 2 \zeta_s) f_c (\tau - \tau_0) - (\beta \sigma_c + 2 \zeta_c) f_s (\tau - \tau_0)) \\
&+ \frac{2}{\rho \beta_p} 2 \pi x_0 \cos \left( 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_0) \right) ((\beta_p \sigma_c + 2 \zeta_c) f_c (\tau - \tau_0) + (\beta \sigma_s + 2 \zeta_s) f_s (\tau - \tau_0)) 
\end{split} \label{eq:FULLONMOTION}
\end{align}
Now we would like to determine the motion arising from a series of kicks at time $\{ \tau_i \}$, which results in a corresponding change in velocity of $\{ v_i \}$. (Note that this change in velocity is still referring to a change in velocity of a mode, not an ion). To determine the resulting motion, we can use the linearity of the equation of motion to write the solution as a sum of solutions which satisfy the change in velocity as initial conditions. \par
\medskip
\noindent First we recall that $v_p$ is defined as the linearised modes of the \textit{displaced} ion positions from equilibrium (not the absolute ion positions). Thus, if we assume that the ions start (at $\tau = \tau_0$) at their equilibrium positions, then the linear combinations of the displaced positions from equilibrium that constitute $v_p$ will also be 0 -- this produces an initial modal displacement of $x_0 = 0$ at $\tau = \tau_0$. \eqref{eq:FULLONMOTION} therefore simplifies to: 
\begin{align}
	\begin{split}
v_p (\tau) & = \frac{2 \beta}{\rho \beta_p} v_0 \sin \left( 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_0) \right) (\sigma_c f_c (\tau - \tau_0) + \sigma_s f_s (\tau - \tau_0)) \\
&+ \frac{2 \beta}{\rho \beta_p} v_0 \cos \left( 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_0) \right) (\sigma_c f_s (\tau - \tau_0) - \sigma_s f_c (\tau - \tau_0))
\end{split} \label{eq:phoebe}
\end{align}
\noindent Now, if we consider all the pulses independently of one another, then we would expect that the trajectory after each pulse will also satisfy \eqref{eq:phoebe}, though now with initial velocity $v_i$ at time $\tau = \tau_i$ (and corresponding changes to the constants that depend on the initial conditions, ie. $\sigma_c$, $\sigma_s$ and $\rho$). Because the pulses do not instantaneously change the position of the ions (and therefore the modes), we can consider the initial condition of each pulse application to be $x_i = 0$\footnote{This is in the same way that we consider the initial velocity for each pulse to be $v_i$, not $v(\tau_i - \delta) + v_i$ (where $v(\tau_i - \delta)$ is the velocity of the mode instantaneously before the application of the pulse). Hence, we do not need to account for the position instantaneously before the application of the pulse}. That is, we can consider the application of each pulse as a new, independent trajectory with initial conditions as the instantaneous motional changes it enforces. Thus,  the motion after pulse $i$ (disregarding evolution due to previous and subsequent pulses) will be given by:
\begin{align}
	\begin{split}
v_p (\tau) & = \frac{2 \beta}{\rho_i \beta_p} v_i \sin \left( 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_i) \right) (\sigma_{c,i} f_c (\tau - \tau_i) + \sigma_{s,i} f_s (\tau - \tau_i)) \\
&+ \frac{2 \beta}{\rho \beta_p} v_i \cos \left( 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_i) \right) (\sigma_{c,i} f_s (\tau - \tau_i) - \sigma_{s,i} f_c (\tau - \tau_i))
\end{split} \label{eq:phoebe2}
\end{align}
where the constants $\sigma_{c,i}$, $\sigma_{s,i}$ and $\rho_i$ are now specific to the time $\tau_i$. Because the motion is linear, we can simply add the trajectories for all the pulses (treated individually) together. This gives the full motion as:
\begin{align}
\begin{split}
v_p (\tau) &= \sum_{i=0}^n \frac{2 \beta}{\rho_i \beta_p} v_i \sin \left( 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_i) \right) (\sigma_{c,i} f_c (\tau - \tau_i) + \sigma_{s,i} f_s (\tau - \tau_i)) \\
&+ \sum_{i = 0}^n \frac{2 \beta}{\rho_i \beta_p} v_i \cos \left( 2 \pi \frac{\beta_p}{\beta} (\tau - \tau_i) \right) (\sigma_{c,i} f_s (\tau - \tau_i) - \sigma_{s,i} f_c (\tau - \tau_i))
\end{split}
\end{align}




\end{document}
